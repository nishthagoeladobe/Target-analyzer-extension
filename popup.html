<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adobe Target Inspector</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <img src="icons/icon-48.png" alt="Adobe Target Inspector" class="logo-icon">
          <h1>Adobe Target Inspector</h1>
        </div>
        <div class="status" id="status">
          <span class="status-indicator" id="statusIndicator"></span>
          <span id="statusText">Monitoring...</span>
        </div>
      </div>
    </header>

    <div class="main-layout">
      <!-- Sidebar Navigation -->
      <nav class="sidebar">
        <div class="sidebar-section">
          <div class="sidebar-section-title">ANALYZE</div>
          <button class="sidebar-item active" data-view="activities" data-requires="none">
            <span class="sidebar-icon">ğŸ¯</span>
            <span class="sidebar-label">Activities</span>
            <span class="sidebar-badge" id="activitiesBadge">0</span>
          </button>
        </div>

          <div class="sidebar-section">
            <div class="sidebar-section-title">TOOLS</div>
            <button class="sidebar-item" data-view="events" data-requires="none">
              <span class="sidebar-icon">ğŸ“¡</span>
              <span class="sidebar-label">Events</span>
              <span class="sidebar-badge" id="eventsBadge">0</span>
            </button>
            <button class="sidebar-item" data-view="ids" data-requires="none">
              <span class="sidebar-icon">ğŸ†”</span>
              <span class="sidebar-label">IDs</span>
            </button>
            <button class="sidebar-item" data-view="performance" data-requires="monitoring">
              <span class="sidebar-icon">âš¡</span>
              <span class="sidebar-label">Performance</span>
              <span class="sidebar-lock">ğŸ”’</span>
            </button>
            <button class="sidebar-item" data-view="snippettest" data-requires="monitoring">
              <span class="sidebar-icon">ğŸ§ª</span>
              <span class="sidebar-label">Snippet Test</span>
              <span class="sidebar-lock">ğŸ”’</span>
            </button>
          </div>

        <div class="sidebar-section sidebar-bottom">
          <button class="sidebar-item" data-view="help" data-requires="none">
            <span class="sidebar-icon">â„¹ï¸</span>
            <span class="sidebar-label">Help</span>
          </button>
        </div>
      </nav>

      <!-- Main Content Area -->
      <main class="content-area">

        <!-- Workflow Steps Indicator -->
        <div class="workflow-steps" id="workflowSteps">
          <div class="workflow-step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-label">Start Monitoring</div>
          </div>
          <div class="workflow-arrow">â†’</div>
          <div class="workflow-step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-label">Detect Activities</div>
          </div>
          <div class="workflow-arrow">â†’</div>
          <div class="workflow-step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-label">Analyze Data</div>
          </div>
        </div>

        <!-- Activities View -->
        <div id="activities" class="view-panel active">
        <!-- Sticky Header with Summary and Actions -->
        <div class="activities-sticky-header">
          <div class="activity-summary" id="activitySummary">
            <div class="summary-card">
              <div class="summary-number" id="totalActivities">0</div>
              <div class="summary-label">Activities</div>
            </div>
            <div class="summary-card">
              <div class="summary-number" id="activeMboxes">0</div>
              <div class="summary-label">Mboxes</div>
            </div>
          </div>

          <div class="activity-actions-compact" id="activityActions" style="display: none;">
            <button class="btn-icon" id="analyzePerformance" title="Analyze Target Performance">
              âš¡
            </button>
            <button class="btn-icon" id="testSnippetImpact" title="Test Prehiding Snippet Impact">
              ğŸ§ª
            </button>
            <button class="btn-icon" id="copyAllActivities" title="Download Complete Report (CSV)">
              ğŸ“Š
            </button>
          </div>
        </div>

        <div class="loading-container" id="loadingContainer" style="display: none;">
          <div class="spinner"></div>
          <p>Detecting Adobe Target activities...</p>
        </div>

        <div class="activity-list" id="activityList">
          <div class="empty-state" id="emptyState">
            <div class="empty-icon">ğŸ¯</div>
            <h3>No Adobe Target activities detected</h3>
            <p>Browse the website to see personalization and testing activities.</p>
            <div class="debugger-notice" style="margin-top: 12px; padding: 8px 12px; background: #f0f9ff; border-radius: 6px; font-size: 12px; color: #0369a1;">
              â„¹ï¸ <strong>Note:</strong> Chrome may show a "debugging" notification - this is normal and allows the extension to detect Adobe Target activities.
            </div>
          </div>
        </div>

        <!-- Sticky Bottom Controls -->
        <div class="activities-controls">
          <button id="clearActivities" class="btn-control btn-secondary">Clear</button>
          <button id="refreshActivities" class="btn-control btn-primary">ğŸ” Start Monitoring</button>
        </div>
      </div>

        <!-- Events View -->
        <div id="events" class="view-panel">
        <div class="events-header">
          <h2>ğŸ“¡ Network Events</h2>
          <p class="events-subtitle">All Adobe Target network requests and interactions</p>
        </div>

        <div class="events-summary">
          <div class="summary-card">
            <div class="summary-number" id="totalEvents">0</div>
            <div class="summary-label">Total Events</div>
          </div>
          <div class="summary-card">
            <div class="summary-number" id="interactCalls">0</div>
            <div class="summary-label">Interact Calls</div>
          </div>
          <div class="summary-card">
            <div class="summary-number" id="deliveryCalls">0</div>
            <div class="summary-label">Delivery Calls</div>
          </div>
        </div>

        <div class="events-list" id="eventsList">
          <div class="empty-state">
            <div class="empty-icon">ğŸ“¡</div>
            <h3>No events captured yet</h3>
            <p>Network events will appear here when Adobe Target makes requests.</p>
          </div>
        </div>
      </div>

      <!-- IDs Tab -->
      <div id="ids" class="view-panel">
        <div class="ids-header">
          <h2>ğŸ†” Visitor IDs</h2>
          <p class="ids-subtitle">Adobe Target and Experience Cloud visitor identifiers</p>
        </div>

        <div class="ids-content-scroll" id="idsContentScroll">
          <div class="empty-state">
            <div class="empty-icon">ğŸ†”</div>
            <h3>No IDs detected yet</h3>
            <p>Start monitoring to capture visitor identifiers.</p>
          </div>
        </div>
      </div>

      <!-- Details Tab -->
      <div id="details" class="view-panel">
        <div id="detailsContent" class="details-content">
          <div class="empty-details">
            <div class="empty-icon">ğŸ“‹</div>
            <h3>No activity details available</h3>
            <p>Click on an activity in the Activities tab to see detailed information.</p>
          </div>
        </div>
      </div>

      <!-- Performance Tab -->
      <div id="performance" class="view-panel">
        <div class="performance-header">
          <h2>âš¡ Performance Metrics</h2>
          <div class="performance-actions">
            <button id="refreshPerformance" class="btn-refresh">ğŸ”„ Refresh Metrics</button>
            <button id="downloadAuditReport" class="btn-audit-report">ğŸ“Š Download Audit Report</button>
          </div>
        </div>

        <div class="performance-content-scroll">
        <!-- Guidance Banner - shown when no data -->
        <div class="performance-guidance-banner" id="performanceGuidanceBanner">
          <div class="guidance-icon">â„¹ï¸</div>
          <div class="guidance-content">
            <h3>Two Ways to View Performance Metrics</h3>
            <div class="guidance-options">
              <div class="guidance-option">
                <div class="option-badge">Option 1</div>
                <strong>Basic Page Metrics</strong>
                <p>Click <strong>"ğŸ”„ Refresh Metrics"</strong> above for page load, FCP, and tag library timing</p>
              </div>
              <div class="guidance-option highlight">
                <div class="option-badge primary">Option 2 (Recommended)</div>
                <strong>Full Target Performance Analysis</strong>
                <p>
                  1. Go to <strong>Activities</strong> tab<br>
                  2. Click <strong>"ğŸ” Start Monitoring & Reload"</strong><br>
                  3. Wait for activities to be detected<br>
                  4. Click <strong>"âš¡ Analyze Target Performance"</strong>
                </p>
                <p style="margin-top: 8px; font-size: 11px; color: #dc2626;">
                  <strong>This shows:</strong> Individual activity timing, flicker per activity, and complete analysis
                </p>
              </div>
            </div>
          </div>
        </div>

        <div class="performance-summary">
          <div class="perf-card">
            <div class="perf-icon">âš¡</div>
            <div class="perf-value" id="pageLoadTime">-</div>
            <div class="perf-label">Page Load Time</div>
          </div>
          <div class="perf-card">
            <div class="perf-icon">ğŸ¨</div>
            <div class="perf-value" id="firstPaint">-</div>
            <div class="perf-label">First Paint</div>
          </div>
          <div class="perf-card">
            <div class="perf-icon">ğŸ“¦</div>
            <div class="perf-value" id="firstContentfulPaint">-</div>
            <div class="perf-label">First Contentful Paint</div>
          </div>
        </div>

        <!-- Individual Activities Breakdown (Only if activities detected) -->
        <div class="performance-section" id="activitiesBreakdownSection" style="display: none;">
          <h3>ğŸ¯ Target Activities Performance ({{activityCount}} activities)</h3>
          <div id="activitiesPerformanceBreakdown"></div>
        </div>

        <!-- Adobe Target Timing -->
        <div class="performance-section">
          <h3>ğŸ¯ Adobe Target Timing</h3>
          <div class="timing-details-table">
            <table class="timing-table">
              <thead>
                <tr>
                  <th>Event</th>
                  <th>Start Time</th>
                  <th>Duration</th>
                  <th>End Time</th>
                </tr>
              </thead>
              <tbody id="timingTableBody">
                <tr>
                  <td colspan="4" class="no-timing-data">Loading timing data...</td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="timing-chart" id="targetTimingChart">
            <h4 style="margin-top: 20px; margin-bottom: 12px; font-size: 14px; color: #6b7280;">Event Sequence Timeline</h4>
            <div class="chart-timeline">
              <div class="timeline-item">
                <div class="timeline-label">Library Load</div>
                <div class="timeline-bar" id="libraryLoadBar">
                  <span class="timeline-value" id="libraryLoadTime">-</span>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-label">Activity Delivery</div>
                <div class="timeline-bar" id="activityDeliveryBar">
                  <span class="timeline-value" id="activityDeliveryTime">-</span>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-label">Flicker Duration</div>
                <div class="timeline-bar" id="flickerDurationBar">
                  <span class="timeline-value" id="flickerDuration">-</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Metrics -->
        <div class="performance-section">
          <h3>ğŸ“Š Detailed Metrics</h3>
          <div class="metrics-grid">
            <div class="metric-item">
              <span class="metric-label">DNS Lookup:</span>
              <span class="metric-value" id="dnsTime">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">TCP Connection:</span>
              <span class="metric-value" id="tcpTime">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Request Time:</span>
              <span class="metric-value" id="requestTime">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">Response Time:</span>
              <span class="metric-value" id="responseTime">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">DOM Interactive:</span>
              <span class="metric-value" id="domInteractive">-</span>
            </div>
            <div class="metric-item">
              <span class="metric-label">DOM Complete:</span>
              <span class="metric-value" id="domComplete">-</span>
            </div>
          </div>
        </div>

        <!-- Analytics & Recommendations -->
        <div class="performance-section analytics-section" id="analyticsSection">
          <h3>ğŸ’¡ Analytics & Recommendations</h3>
          <div id="performanceAnalytics">
            <div class="analytics-placeholder">
              <p>ğŸ“ˆ Performance data will appear here after page load and Adobe Target activity delivery.</p>
              <p>Click <strong>"Refresh Metrics"</strong> to analyze current page performance.</p>
            </div>
          </div>
        </div>

        <!-- Impact Analysis -->
        <div class="performance-section">
          <h3>ğŸ” Adobe Target Impact Analysis</h3>
          <div class="impact-summary" id="impactSummary">
            <div class="impact-card">
              <div class="impact-label">Target Overhead</div>
              <div class="impact-value" id="targetOverhead">-</div>
              <div class="impact-status" id="targetOverheadStatus">â³ Calculating...</div>
              <div class="impact-formula" id="targetOverheadFormula"></div>
            </div>
            <div class="impact-card">
              <div class="impact-label">Flicker Risk</div>
              <div class="impact-value" id="flickerRisk">-</div>
              <div class="impact-status" id="flickerRiskStatus">â³ Calculating...</div>
              <div class="impact-formula" id="flickerFormula"></div>
            </div>
            <div class="impact-card">
              <div class="impact-label">Optimization Score</div>
              <div class="impact-value" id="optimizationScore">-</div>
              <div class="impact-status" id="optimizationScoreStatus">â³ Calculating...</div>
              <div class="impact-formula" id="scoreFormula"></div>
            </div>
          </div>
        </div>
        </div>
        <!-- End performance-content-scroll -->
      </div>

      <!-- Prehiding Snippet Test Tab -->
      <div id="snippettest" class="view-panel">
        <div class="flicker-test-header">
          <h2>ğŸ§ª Prehiding Snippet Performance Test</h2>
          <p class="flicker-test-subtitle">Measure Adobe Target's complete performance impact: WITH vs WITHOUT prehiding snippet</p>
        </div>

        <div class="snippet-content-scroll">
        <!-- Snippet Status Section -->
        <div class="flicker-section">
          <h3>ğŸ“‹ Current Status</h3>
          <div class="snippet-status-card" id="snippetStatusCard">
            <div class="status-row">
              <span class="status-label">Prehiding Snippet:</span>
              <span class="status-value" id="snippetDetected">
                <span class="spinner-small"></span> Detecting...
              </span>
            </div>
            <div class="snippet-details" id="snippetDetails" style="display: none;">
              <div class="detail-row">
                <span class="detail-label">Timeout:</span>
                <span class="detail-value" id="snippetTimeout">-</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Style Applied:</span>
                <span class="detail-value" id="snippetStyle">-</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Script Location:</span>
                <span class="detail-value" id="snippetLocation">-</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Test Controls Section -->
        <div class="flicker-section">
          <h3>ğŸ® Run Test</h3>
          <div class="test-controls-card">
            <div class="test-warning">
              <div class="warning-icon">âš ï¸</div>
              <div class="warning-content">
                <strong>Important:</strong> This test will reload the page twice to measure performance with different configurations.
                <ul style="margin: 8px 0 0 20px; font-size: 12px;">
                  <li>First: Measure WITH prehiding snippet (current state)</li>
                  <li>Second: Measure WITHOUT prehiding snippet (snippet blocked)</li>
                  <li>Results will show real flicker difference</li>
                </ul>
              </div>
            </div>
            
            <div class="test-buttons">
              <button id="runFlickerTest" class="btn-test-primary">
                ğŸš€ Run A/B Test (2 page reloads)
              </button>
              <button id="clearCacheBtn" class="btn-test-secondary">
                ğŸ§¹ Clear Cache & Reload
              </button>
            </div>

            <div class="test-status" id="testStatus" style="display: none;">
              <div class="progress-indicator">
                <div class="progress-bar">
                  <div class="progress-fill" id="testProgress"></div>
                </div>
                <div class="progress-text" id="testProgressText">Initializing test...</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Results Section -->
        <div class="flicker-section" id="resultsSection" style="display: none;">
          <h3>ğŸ“Š Test Results</h3>
          <div class="results-comparison">
            <!-- WITH Snippet Column -->
            <div class="result-column with-snippet">
              <div class="result-header">
                <div class="result-badge success">âœ… WITH Snippet</div>
                <div class="result-title">Prehiding Active</div>
              </div>
              <div class="result-metrics">
                <div class="result-metric">
                  <span class="metric-icon">âš¡</span>
                  <div class="metric-content">
                    <span class="metric-label">Flicker Duration</span>
                    <span class="metric-value" id="flickerWith">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">ğŸ¯</span>
                  <div class="metric-content">
                    <span class="metric-label">First Contentful Paint</span>
                    <span class="metric-value" id="fcpWith">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">ğŸ“¦</span>
                  <div class="metric-content">
                    <span class="metric-label">Activity Applied</span>
                    <span class="metric-value" id="activityWith">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">â±ï¸</span>
                  <div class="metric-content">
                    <span class="metric-label">Page Load Time</span>
                    <span class="metric-value" id="pageLoadWith">-</span>
                  </div>
                </div>
              </div>
              <div class="result-status" id="statusWith">
                <span class="status-badge">-</span>
              </div>
            </div>

            <!-- VS Divider -->
            <div class="vs-divider">
              <div class="vs-circle">VS</div>
              <div class="impact-summary" id="impactSummary">
                <div class="impact-value" id="flickerDifference">-</div>
                <div class="impact-label">Flicker Prevented</div>
              </div>
            </div>

            <!-- WITHOUT Snippet Column -->
            <div class="result-column without-snippet">
              <div class="result-header">
                <div class="result-badge warning">âš ï¸ WITHOUT Snippet</div>
                <div class="result-title">No Prehiding</div>
              </div>
              <div class="result-metrics">
                <div class="result-metric">
                  <span class="metric-icon">âš¡</span>
                  <div class="metric-content">
                    <span class="metric-label">Flicker Duration</span>
                    <span class="metric-value" id="flickerWithout">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">ğŸ¯</span>
                  <div class="metric-content">
                    <span class="metric-label">First Contentful Paint</span>
                    <span class="metric-value" id="fcpWithout">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">ğŸ“¦</span>
                  <div class="metric-content">
                    <span class="metric-label">Activity Applied</span>
                    <span class="metric-value" id="activityWithout">-</span>
                  </div>
                </div>
                <div class="result-metric">
                  <span class="metric-icon">â±ï¸</span>
                  <div class="metric-content">
                    <span class="metric-label">Page Load Time</span>
                    <span class="metric-value" id="pageLoadWithout">-</span>
                  </div>
                </div>
              </div>
              <div class="result-status" id="statusWithout">
                <span class="status-badge">-</span>
              </div>
            </div>
          </div>

          <!-- Detailed Analysis -->
          <div class="detailed-analysis">
            <h4>ğŸ” Detailed Analysis</h4>
            <div class="analysis-content" id="detailedAnalysis">
              <p>Analysis will appear here after test completion...</p>
            </div>
          </div>

          <!-- Recommendations -->
          <div class="recommendations-box">
            <h4>ğŸ’¡ Recommendations</h4>
            <div class="recommendations-content" id="recommendationsContent">
              <p>Recommendations will appear here after test completion...</p>
            </div>
          </div>
        </div>

        <!-- Calculation Explanation -->
        <div class="flicker-section calculation-section">
          <h3>ğŸ“ How We Calculate Flicker</h3>
          <div class="calculation-content">
            <div class="calculation-formula">
              <div class="formula-box">
                <div class="formula-title">Flicker Duration Formula:</div>
                <div class="formula-equation">
                  <span class="formula-var">Flicker</span> = 
                  <span class="formula-var">Activity Time</span> - 
                  <span class="formula-var">FCP</span>
                </div>
                <div class="formula-result">= Time user saw wrong content before Target changed it</div>
              </div>
            </div>

            <div class="metric-explanations">
              <div class="metric-explain">
                <div class="metric-explain-icon">ğŸ¯</div>
                <div class="metric-explain-content">
                  <strong>FCP (First Contentful Paint):</strong>
                  <p>Time when user <strong>first sees content</strong> on the page (ms from page load)</p>
                  <code>window.performance.getEntriesByType('paint')</code>
                </div>
              </div>

              <div class="metric-explain">
                <div class="metric-explain-icon">ğŸ“¦</div>
                <div class="metric-explain-content">
                  <strong>Activity Applied:</strong>
                  <p>Time when Adobe Target <strong>delivered personalized content</strong> (ms from page load)</p>
                  <p style="font-size: 12px; margin-top: 4px;">
                    â€¢ <strong>Alloy.js:</strong> <code>adobedc.demdex.net/ee/v1/interact</code><br>
                    â€¢ <strong>at.js:</strong> <code>tt.omtrdc.net/rest/v1/delivery</code>
                  </p>
                  <p style="font-size: 11px; margin-top: 6px; color: #9ca3af;">
                    <strong>Multiple Activities:</strong> If page has multiple activities, we use the <strong>LATEST</strong> delivery time (when all personalization is complete).
                  </p>
                </div>
              </div>

              <div class="metric-explain">
                <div class="metric-explain-icon">âš¡</div>
                <div class="metric-explain-content">
                  <strong>Flicker Duration:</strong>
                  <p>The gap between user seeing page and Target changing it</p>
                  <div class="flicker-visual">
                    <div class="timeline">
                      <span class="timeline-point fcp-point">ğŸ“ FCP (180ms)</span>
                      <span class="timeline-line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
                      <span class="timeline-point activity-point">ğŸ“ Activity (4344ms)</span>
                    </div>
                    <div class="timeline-label">âš¡ Flicker = 4164ms (user saw default content)</div>
                  </div>
                  <p style="margin-top: 8px;">
                    âœ… <strong>Good:</strong> &lt; 300ms (barely noticeable)<br>
                    âš ï¸ <strong>Bad:</strong> &gt; 300ms (visible content jump)
                  </p>
                </div>
              </div>
            </div>

            <div class="calculation-note">
              <strong>ğŸ’¡ Why This Matters:</strong>
              <p>High flicker means users see default content change to personalized content. The prehiding snippet prevents this by hiding the page (<code>opacity: 0</code>) until Target is ready.</p>
            </div>
          </div>
        </div>

        <!-- Help Section -->
        <div class="flicker-section help-section">
          <h3>â“ How This Works</h3>
          <div class="help-content">
            <div class="help-item">
              <div class="help-icon">1ï¸âƒ£</div>
              <div class="help-text">
                <strong>Detects Prehiding Snippet:</strong> Checks if Adobe Target's prehiding snippet exists in your page's <code>&lt;head&gt;</code>
              </div>
            </div>
            <div class="help-item">
              <div class="help-icon">2ï¸âƒ£</div>
              <div class="help-text">
                <strong>Runs First Test (WITH):</strong> Reloads page normally and measures flicker with snippet active
              </div>
            </div>
            <div class="help-item">
              <div class="help-icon">3ï¸âƒ£</div>
              <div class="help-text">
                <strong>Runs Second Test (WITHOUT):</strong> Blocks prehiding snippet, reloads page, and measures flicker
              </div>
            </div>
            <div class="help-item">
              <div class="help-icon">4ï¸âƒ£</div>
              <div class="help-text">
                <strong>Compares Results:</strong> Shows you exactly how much flicker the snippet prevents
              </div>
            </div>
          </div>
          
          <div class="what-is-prehiding">
            <h4>ğŸ›¡ï¸ What is a Prehiding Snippet?</h4>
            <p>The prehiding snippet is a small JavaScript code that temporarily hides your page content (<code>opacity: 0</code>) while Adobe Target loads personalized content. This prevents "flicker" - the brief moment where visitors see default content before it changes to personalized content.</p>
            <p><strong>Without the snippet:</strong> Visitors see original content â†’ flicker â†’ personalized content</p>
            <p><strong>With the snippet:</strong> Page hidden â†’ personalized content loads â†’ page shows (no flicker)</p>
          </div>
        </div>
        </div>
        <!-- End snippet-content-scroll -->
      </div>

      <!-- Explanation Tab -->
      <div id="explanation" class="view-panel">
        <div class="explanation-content">
          <h2>ğŸ¯ What is Adobe Target?</h2>
          <p>Adobe Target is a tool that helps websites show different content to different visitors to improve their experience and increase business results.</p>
          
          <h3>ğŸ“Š Response Parameters Explained:</h3>
          <p>When you see data in the Details section, here's what each parameter means:</p>

          <div class="parameter-section">
            <h4>ğŸ·ï¸ Response Tokens</h4>
            <div class="param-explanation">
              <strong>activity.name:</strong> The name of the marketing campaign or test (e.g., "Holiday Promotion 2025")
            </div>
            <div class="param-explanation">
              <strong>activity.id:</strong> Unique number identifying this specific campaign
            </div>
            <div class="param-explanation">
              <strong>experience.name:</strong> Which version of the test you're seeing (e.g., "Version A", "Control")
            </div>
            <div class="param-explanation">
              <strong>experience.id:</strong> Unique number for this specific version
            </div>
            <div class="param-explanation">
              <strong>geo.dma:</strong> Your geographic market area (like "denver", "new-york")
            </div>
            <div class="param-explanation">
              <strong>geo.zip:</strong> Your zip code area for location-based targeting
            </div>
            <div class="param-explanation">
              <strong>profile.categoryAffinities:</strong> Your interests based on browsing (e.g., "mortgage", "credit-card")
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ“‹ Request Details</h4>
            <div class="param-explanation">
              <strong>id.tntId:</strong> Your unique visitor ID for Adobe Target
            </div>
            <div class="param-explanation">
              <strong>id.marketingCloudVisitorId:</strong> Your Adobe Experience Cloud visitor ID
            </div>
            <div class="param-explanation">
              <strong>execute.pageLoad:</strong> Request to get content for the main page
            </div>
            <div class="param-explanation">
              <strong>execute.mboxes:</strong> Specific areas on the page requesting personalized content
            </div>
            <div class="param-explanation">
              <strong>prefetch.views:</strong> Pre-loading content for single-page applications
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ“¤ Analytics Integration</h4>
            <div class="param-explanation">
              <strong>analytics.logging:</strong> Whether Adobe Analytics is tracking this activity
            </div>
            <div class="param-explanation">
              <strong>analytics.payload:</strong> Data being sent to Adobe Analytics for reporting
            </div>
            <div class="param-explanation">
              <strong>trackingServer:</strong> The server collecting your analytics data
            </div>
            <div class="param-explanation">
              <strong>trackingServerSecure:</strong> Secure server for analytics data collection
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ¨ Page Modifications</h4>
            <div class="param-explanation">
              <strong>type: "setHtml":</strong> Replacing content on the page with new HTML
            </div>
            <div class="param-explanation">
              <strong>selector:</strong> Which part of the page is being changed (CSS selector)
            </div>
            <div class="param-explanation">
              <strong>content:</strong> The new content being displayed to you
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ“Š Implementation Types</h4>
            <div class="param-explanation">
              <strong>at.js (Red Badge):</strong> Traditional Adobe Target implementation using delivery calls
            </div>
            <div class="param-explanation">
              <strong>alloy.js (Black Badge):</strong> Modern Adobe Experience Platform Web SDK using interact calls
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ”„ Alloy.js (Web SDK) Specific Parameters</h4>
            <div class="param-explanation">
              <strong>scope:</strong> The location on the page where content should be delivered (e.g., "__view__", "BOA_HOME_SIGNON_BANNER")
            </div>
            <div class="param-explanation">
              <strong>scopeDetails.decisionProvider:</strong> Always "TGT" for Adobe Target decisions
            </div>
            <div class="param-explanation">
              <strong>scopeDetails.activity.id:</strong> Unique identifier for the Target activity
            </div>
            <div class="param-explanation">
              <strong>scopeDetails.experience.id:</strong> Which variation of the test you're seeing
            </div>
            <div class="param-explanation">
              <strong>scopeDetails.correlationID:</strong> Unique tracking ID linking activity, experience, and traffic allocation
            </div>
            <div class="param-explanation">
              <strong>characteristics.displayToken:</strong> Token used for tracking when content is displayed
            </div>
            <div class="param-explanation">
              <strong>characteristics.clickToken:</strong> Token used for tracking when content is clicked
            </div>
            <div class="param-explanation">
              <strong>items[].schema:</strong> Type of content being delivered (html-content-item, measurement, etc.)
            </div>
            <div class="param-explanation">
              <strong>items[].data.format:</strong> Content format like "text/html" for HTML content
            </div>
            <div class="param-explanation">
              <strong>items[].data.content:</strong> The actual content/HTML being delivered to the page
            </div>
          </div>

          <div class="parameter-section">
            <h4>ğŸ—ï¸ Handle Array Structure (Alloy.js)</h4>
            <div class="param-explanation">
              <strong>handle[].type:</strong> Type of response - "personalization:decisions" for Target content
            </div>
            <div class="param-explanation">
              <strong>handle[].payload:</strong> Array containing all the decisions/activities for this request
            </div>
            <div class="param-explanation">
              <strong>handle[].eventIndex:</strong> Which event in the request this response corresponds to
            </div>
          </div>

          <div class="parameter-section">
            <h4>âš–ï¸ Key Differences: at.js vs Alloy.js</h4>
            <div class="param-explanation">
              <strong>at.js Delivery Calls:</strong> Use "mboxes" and "execute" structure with response tokens in meta data
            </div>
            <div class="param-explanation">
              <strong>Alloy.js Interact Calls:</strong> Use "scopes" and "handle" structure with decisions and characteristics
            </div>
            <div class="param-explanation">
              <strong>Content Delivery:</strong> at.js uses pageLoad/mboxes, Alloy.js uses scoped decisions
            </div>
            <div class="param-explanation">
              <strong>Tracking Tokens:</strong> at.js uses eventTokens, Alloy.js uses displayToken/clickToken
            </div>
          </div>

          <h3>ğŸ” Why This Matters:</h3>
          <p>This data helps you understand:</p>
          <ul>
            <li>What personalized content you're seeing</li>
            <li>Why you're seeing specific experiences</li>
            <li>How the website is tracking your interactions</li>
            <li>What tests or campaigns are currently running</li>
            <li>Which Adobe Target implementation the site is using</li>
          </ul>

          <div class="parameter-section report-error-section">
            <h4>ğŸ› Report Error or Issue</h4>
            <p>Found a bug or have feedback? Let us know!</p>
            <div class="error-report-form">
              <textarea id="errorReportText" placeholder="Describe the issue you're experiencing, what website you were on, what you expected to see vs what actually happened..." rows="4"></textarea>
              <div class="report-actions">
                <button id="submitErrorReport" class="btn btn-primary">ğŸ“§ Send Report</button>
                <span id="reportStatus" class="report-status"></span>
              </div>
            </div>
          </div>
        </div>
        <!-- End Help View -->

      </main>
      <!-- End Content Area -->
    </div>
    <!-- End Main Layout -->

  </div>
  <!-- End Container -->

  <script src="popup.js"></script>
</body>
</html> 